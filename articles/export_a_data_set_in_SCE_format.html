<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Export a data set in SCE format • cerebroApp</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Export a data set in SCE format">
<meta property="og:description" content="cerebroApp">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cerebroApp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cerebroApp_workflow_Seurat.html">The cerebroApp workflow (Seurat)</a>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">The Cerebro interface</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/Cerebro_interface_v1.2.html">Cerebro v1.2 and older</a>
        </li>
      </ul>
</li>
    <li>
      <a href="../articles/export_a_data_set_in_SCE_format.html">Export an SCE/SingleCellExperiment object</a>
    </li>
    <li>
      <a href="../articles/export_and_visualize_custom_tables_and_plots.html">Export and visualize custom tables and plots</a>
    </li>
    <li>
      <a href="../articles/launch_cerebro_with_pre-loaded_data_set.html">Launch Cerebro with pre-loaded data set</a>
    </li>
    <li>
      <a href="../articles/host_cerebro_on_shinyapps.html">Host Cerebro on shinyapps.io</a>
    </li>
    <li>
      <a href="../articles/control_access_to_cerebro_with_a_login_page.html">Control access to Cerebro with a login page</a>
    </li>
    <li>
      <a href="../articles/overview_of_cerebro_v1.3_class.html">Overview of the Cerebro v1.3 class</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Release notes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/release_notes_v1.3.html">v1.3</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/romanhaa/cerebroApp/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/fakechek1">
    <span class="fab fa-twitter fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="export_a_data_set_in_SCE_format_files/header-attrs-2.6/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Export a data set in SCE format</h1>
                        <h4 class="author">Roman Hillje</h4>
            
            <h4 class="date">12 March, 2021</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/romanhaa/cerebroApp/blob/master/vignettes/export_a_data_set_in_SCE_format.Rmd"><code>vignettes/export_a_data_set_in_SCE_format.Rmd</code></a></small>
      <div class="hidden name"><code>export_a_data_set_in_SCE_format.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h1>
<p>Here, I explain how one can export a data set stored in the <a href="https://bioconductor.org/packages/release/bioc/html/SingleCellExperiment.html"><code>SingleCellExperiment</code>/<code>SCE</code></a> format to visualize it in Cerebro.</p>
<p>The workflow used here is loosely put together from the <a href="https://bioconductor.org/packages/release/bioc/vignettes/scran/inst/doc/scran.html"><code>scran</code></a> and <a href="https://bioconductor.org/packages/3.11/bioc/vignettes/scater/inst/doc/overview.html"><code>scater</code></a> examples. Do not use this workflow as a reference for how to properly process your data.</p>
</div>
<div id="installation" class="section level1">
<h1 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h1>
<p>Before starting the workflow, we need to install <code>cerebroApp</code>, as well as the <a href="https://bioconductor.org/packages/release/bioc/html/scran.html"><code>scran</code></a>, <a href="https://bioconductor.org/packages/3.11/bioc/html/scater.html"><code>scater</code></a> and <a href="https://www.bioconductor.org/packages/release/bioc/html/SingleR.html"><code>SingleR</code></a> packages, which are not installed as dependencies of cerebroApp because they are only necessary if you want/need to pre-process your scRNA-seq data. If you just want to launch the Cerebro user interface, e.g. because you already have the pre-processed data, you don’t need those packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span> <span class="st">'BiocManager'</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html">installed.packages</a></span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span> <span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'BiocManager'</span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">BiocManager</span><span class="op">)</span>

<span class="kw">if</span> <span class="op">(</span> <span class="st">'cerebroApp'</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html">installed.packages</a></span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span> <span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocManager/man/install.html">install</a></span><span class="op">(</span><span class="st">'romanhaa/cerebroApp'</span><span class="op">)</span>
<span class="kw">if</span> <span class="op">(</span> <span class="st">'scran'</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html">installed.packages</a></span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span> <span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocManager/man/install.html">install</a></span><span class="op">(</span><span class="st">'scran'</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; The downloaded binary packages are in</span>
<span class="co">#&gt;  /var/folders/7z/m3l07m8s6455y1mnykf307_c0000gn/T//RtmpcQU4bH/downloaded_packages</span>
<span class="kw">if</span> <span class="op">(</span> <span class="st">'scater'</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html">installed.packages</a></span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span> <span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocManager/man/install.html">install</a></span><span class="op">(</span><span class="st">'scater'</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; The downloaded binary packages are in</span>
<span class="co">#&gt;  /var/folders/7z/m3l07m8s6455y1mnykf307_c0000gn/T//RtmpcQU4bH/downloaded_packages</span>
<span class="kw">if</span> <span class="op">(</span> <span class="st">'SingleR'</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html">installed.packages</a></span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span> <span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocManager/man/install.html">install</a></span><span class="op">(</span><span class="st">'SingleR'</span><span class="op">)</span>
<span class="kw">if</span> <span class="op">(</span> <span class="st">'monocle'</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html">installed.packages</a></span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span> <span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocManager/man/install.html">install</a></span><span class="op">(</span><span class="st">'monocle'</span><span class="op">)</span></code></pre></div>
</div>
<div id="load-packages" class="section level1">
<h1 class="hasAnchor">
<a href="#load-packages" class="anchor"></a>Load packages</h1>
<p>Apart from the packages we just installed, we will also load the <code>dplyr</code> package and set a seed to make our analysis reproducible.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">scran</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://bioconductor.org/packages/scater/">scater</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/LTLA/SingleR">SingleR</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://romanhaa.github.io/cerebroApp/index.html">cerebroApp</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234567</span><span class="op">)</span></code></pre></div>
</div>
<div id="load-count-data" class="section level1">
<h1 class="hasAnchor">
<a href="#load-count-data" class="anchor"></a>Load count data</h1>
<p>In this example workflow, we will load a small transcript count table from the <a href="https://satijalab.org/seurat/"><code>Seurat</code></a> package containing 80 cells and 230 genes. If you want to try the workflow with a real data set, you can find some transcript count matrices on the <a href="https://github.com/romanhaa/Cerebro/tree/master/examples">Cerebro GitHub repo</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pbmc_counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span>
    file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">'extdata'</span>, <span class="st">'pbmc_raw.txt'</span>, package <span class="op">=</span> <span class="st">'Seurat'</span><span class="op">)</span>,
    as.is <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="pre-processing-with-scran-and-scater" class="section level1">
<h1 class="hasAnchor">
<a href="#pre-processing-with-scran-and-scater" class="anchor"></a>Pre-processing with <code>scran</code> and <code>scater</code>
</h1>
<p>Now, we create a <code>SingleCellExperiment</code> object and filter out cells with less than <code>50</code> transcripts or fewer than <code>10</code> expressed genes. Those cut-offs are only reasonable for this example data set and will likely need to be adjusted in a real data set. Then, we…</p>
<ul>
<li>remove genes expressed in less than 5 cells,</li>
<li>log-normalize transcript counts,</li>
<li>identify highly variably genes,</li>
<li>perform principal component analysis (PCA).</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu">SingleCellExperiment</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/SingleCellExperiment.html">SingleCellExperiment</a></span><span class="op">(</span>
  assays <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>counts <span class="op">=</span> <span class="va">pbmc_counts</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">qc_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scuttle/man/perCellQCMetrics.html">perCellQCMetrics</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span>
<span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span>, <span class="va">qc_metrics</span><span class="op">)</span>

<span class="va">cells_to_keep</span> <span class="op">&lt;-</span> <span class="va">sce</span><span class="op">$</span><span class="va">sum</span> <span class="op">&gt;=</span> <span class="fl">50</span> <span class="op">&amp;</span> <span class="va">sce</span><span class="op">$</span><span class="va">detected</span> <span class="op">&gt;=</span> <span class="fl">10</span>
<span class="va">sce</span> <span class="op">&lt;-</span> <span class="va">sce</span><span class="op">[</span>,<span class="va">cells_to_keep</span><span class="op">]</span>

<span class="va">genes_to_keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/nexprs.html">nexprs</a></span><span class="op">(</span><span class="va">sce</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">5</span>
<span class="va">sce</span> <span class="op">&lt;-</span> <span class="va">sce</span><span class="op">[</span><span class="va">genes_to_keep</span>,<span class="op">]</span>

<span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scuttle/man/logNormCounts.html">logNormCounts</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span>

<span class="va">variable_genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scran/man/modelGeneVar.html">modelGeneVar</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span>
<span class="va">highly_variable_genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scran/man/getTopHVGs.html">getTopHVGs</a></span><span class="op">(</span><span class="va">variable_genes</span>, n <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>

<span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/runPCA.html">runPCA</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span></code></pre></div>
</div>
<div id="clustering" class="section level1">
<h1 class="hasAnchor">
<a href="#clustering" class="anchor"></a>Clustering</h1>
<p>Then, we identify clusters using a graph-based approach.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scran/man/buildSNNGraph.html">buildSNNGraph</a></span><span class="op">(</span><span class="va">sce</span>, use.dimred <span class="op">=</span> <span class="st">"PCA"</span><span class="op">)</span>
<span class="va">cluster</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/cluster_walktrap.html">cluster_walktrap</a></span><span class="op">(</span><span class="va">graph</span><span class="op">)</span><span class="op">$</span><span class="va">membership</span>
<span class="va">sce</span><span class="op">$</span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span></code></pre></div>
</div>
<div id="dimensional-reduction" class="section level1">
<h1 class="hasAnchor">
<a href="#dimensional-reduction" class="anchor"></a>Dimensional reduction</h1>
<p>Next, we use the UMAP technique to generate two- and three-dimensional projections.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/runUMAP.html">runUMAP</a></span><span class="op">(</span>
  <span class="va">sce</span>,
  name <span class="op">=</span> <span class="st">'UMAP'</span>,
  ncomponents <span class="op">=</span> <span class="fl">2</span>,
<span class="op">)</span>

<span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/runUMAP.html">runUMAP</a></span><span class="op">(</span>
  <span class="va">sce</span>,
  name <span class="op">=</span> <span class="st">'UMAP_3D'</span>,
  ncomponents <span class="op">=</span> <span class="fl">3</span>,
<span class="op">)</span></code></pre></div>
</div>
<div id="curate-meta-data" class="section level1">
<h1 class="hasAnchor">
<a href="#curate-meta-data" class="anchor"></a>Curate meta data</h1>
<p>This example data set consists of a single sample so we just add that name to the meta data. Moreover, in order to be able to understand how we did the analysis later, we add some meta data to the <code>misc</code> slot of our <code>SCE</code> object, e.g. an experiment name and the species. The info we store there will later be collected for visualization in Cerebro.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sce</span><span class="op">$</span><span class="va">sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="st">'pbmc'</span>, levels <span class="op">=</span> <span class="st">'pbmc'</span><span class="op">)</span>

<span class="va">sce</span><span class="op">@</span><span class="va">metadata</span><span class="op">$</span><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  experiment_name <span class="op">=</span> <span class="st">'pbmc'</span>,
  organism <span class="op">=</span> <span class="st">'hg'</span>,
  date_of_analysis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">sce</span><span class="op">@</span><span class="va">metadata</span><span class="op">$</span><span class="va">parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  gene_nomenclature <span class="op">=</span> <span class="st">'gene_name'</span>,
  discard_genes_expressed_in_fewer_cells_than <span class="op">=</span> <span class="fl">10</span>,
  keep_mitochondrial_genes <span class="op">=</span> <span class="cn">TRUE</span>,
  variables_to_regress_out <span class="op">=</span> <span class="st">'nUMI'</span>
<span class="op">)</span>

<span class="va">sce</span><span class="op">@</span><span class="va">metadata</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">filtering</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  UMI_min <span class="op">=</span> <span class="fl">50</span>,
  UMI_max <span class="op">=</span> <span class="cn">Inf</span>,
  genes_min <span class="op">=</span> <span class="fl">10</span>,
  genes_max <span class="op">=</span> <span class="cn">Inf</span>
<span class="op">)</span>

<span class="va">sce</span><span class="op">@</span><span class="va">metadata</span><span class="op">$</span><span class="va">technical_info</span><span class="op">$</span><span class="va">cerebroApp_version</span> <span class="op">&lt;-</span> <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span><span class="op">(</span><span class="st">'cerebroApp'</span><span class="op">)</span>
<span class="va">sce</span><span class="op">@</span><span class="va">metadata</span><span class="op">$</span><span class="va">technical_info</span><span class="op">$</span><span class="va">scran</span> <span class="op">&lt;-</span> <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span><span class="op">(</span><span class="st">'scran'</span><span class="op">)</span>
<span class="va">sce</span><span class="op">@</span><span class="va">metadata</span><span class="op">$</span><span class="va">technical_info</span><span class="op">$</span><span class="va">scater</span> <span class="op">&lt;-</span> <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span><span class="op">(</span><span class="st">'scater'</span><span class="op">)</span>
<span class="va">sce</span><span class="op">@</span><span class="va">metadata</span><span class="op">$</span><span class="va">technical_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="st">'R'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html">capture.output</a></span><span class="op">(</span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sessioninfo/man/session_info.html">session_info</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="assign-cell-types" class="section level1">
<h1 class="hasAnchor">
<a href="#assign-cell-types" class="anchor"></a>Assign cell types</h1>
<p>Using the <a href="https://www.bioconductor.org/packages/release/bioc/html/SingleR.html"><code>SingleR</code></a> package, we can get a suggestion of cell type for each cell. Apart from the suggested cell type, we also extract the score that might help us to understand how confident the assignment was.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">singler_ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SingleR/man/datasets.html">BlueprintEncodeData</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Warning: 'BlueprintEncodeData' is deprecated.</span>
<span class="co">#&gt; Use 'celldex::BlueprintEncodeData' instead.</span>
<span class="co">#&gt; See help("Deprecated")</span>
<span class="co">#&gt; using temporary cache /var/folders/7z/m3l07m8s6455y1mnykf307_c0000gn/T//RtmpcQU4bH/BiocFileCache</span>
<span class="co">#&gt; snapshotDate(): 2020-10-27</span>
<span class="co">#&gt; see ?celldex and browseVignettes('celldex') for documentation</span>
<span class="co">#&gt; downloading 1 resources</span>
<span class="co">#&gt; retrieving 1 resource</span>
<span class="co">#&gt; loading from cache</span>
<span class="co">#&gt; see ?celldex and browseVignettes('celldex') for documentation</span>
<span class="co">#&gt; downloading 1 resources</span>
<span class="co">#&gt; retrieving 1 resource</span>
<span class="co">#&gt; loading from cache</span>

<span class="va">singler_results_blueprintencode_main</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SingleR/man/SingleR.html">SingleR</a></span><span class="op">(</span>
  test <span class="op">=</span> <span class="fu">logcounts</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span>,
  ref <span class="op">=</span> <span class="va">singler_ref</span>,
  labels <span class="op">=</span> <span class="va">singler_ref</span><span class="op">@</span><span class="va">colData</span><span class="op">@</span><span class="va">listData</span><span class="op">$</span><span class="va">label.main</span>
<span class="op">)</span>

<span class="va">sce</span><span class="op">$</span><span class="va">cell_type_singler_blueprintencode_main</span> <span class="op">&lt;-</span> <span class="va">singler_results_blueprintencode_main</span><span class="op">@</span><span class="va">listData</span><span class="op">$</span><span class="va">labels</span>

<span class="va">singler_scores</span> <span class="op">&lt;-</span> <span class="va">singler_results_blueprintencode_main</span><span class="op">@</span><span class="va">listData</span><span class="op">$</span><span class="va">scores</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>assigned_score <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span> <span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">singler_scores</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span> <span class="op">{</span>
  <span class="va">singler_scores</span><span class="op">$</span><span class="va">assigned_score</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">singler_scores</span><span class="op">[[</span><span class="va">singler_results_blueprintencode_main</span><span class="op">@</span><span class="va">listData</span><span class="op">$</span><span class="va">labels</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
<span class="op">}</span>

<span class="va">sce</span><span class="op">$</span><span class="va">cell_type_singler_blueprintencode_main_score</span> <span class="op">&lt;-</span> <span class="va">singler_scores</span><span class="op">$</span><span class="va">assigned_score</span></code></pre></div>
<p>##Identify marker genes</p>
<p>Marker genes are genes which are particularly strongly or weakly expressed in a given cell population, e.g. a cluster. This information can help to distinguish the role of different cell groups in the data set. Here, marker genes are identified for clusters and cell types using the <code><a href="https://rdrr.io/pkg/scran/man/findMarkers.html">findMarkers()</a></code> function from the <code>scran</code> package. The results are separate tables for the respective subgroups, which we merge together in order to make them compatible with Cerebro.</p>
<div id="clusters" class="section level2">
<h2 class="hasAnchor">
<a href="#clusters" class="anchor"></a>Clusters</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sce</span><span class="op">@</span><span class="va">metadata</span><span class="op">$</span><span class="va">marker_genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">sce</span><span class="op">@</span><span class="va">metadata</span><span class="op">$</span><span class="va">marker_genes</span><span class="op">$</span><span class="va">scran</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">marker_genes_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scran/man/findMarkers.html">findMarkers</a></span><span class="op">(</span><span class="va">sce</span>, <span class="va">sce</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span> <span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">marker_genes_cluster</span><span class="op">)</span> <span class="op">)</span> <span class="op">{</span>
  <span class="va">marker_genes_cluster</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">marker_genes_cluster</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
      cluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">marker_genes_cluster</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,
      gene <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="va">marker_genes_cluster</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'logFC.'</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">marker_genes_cluster</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>
<span class="op">}</span>

<span class="va">marker_genes_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">bind_rows</span>, <span class="va">marker_genes_cluster</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">cluster</span>, <span class="va">gene</span>, <span class="va">Top</span>, <span class="va">p.value</span>, <span class="va">FDR</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>cluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">cluster</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">sce</span><span class="op">@</span><span class="va">metadata</span><span class="op">$</span><span class="va">marker_genes</span><span class="op">$</span><span class="va">scran</span><span class="op">$</span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="va">marker_genes_cluster</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Top</span><span class="op">)</span>, <span class="va">FDR</span> <span class="op">&lt;=</span> <span class="fl">0.1</span><span class="op">)</span>

<span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">marker_genes_cluster</span><span class="op">)</span>
<span class="co">#&gt; Rows: 876</span>
<span class="co">#&gt; Columns: 10</span>
<span class="co">#&gt; $ cluster       &lt;fct&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …</span>
<span class="co">#&gt; $ gene          &lt;chr&gt; "HLA-DRA", "CST3", "GPX1", "TYMP", "HLA-DRB1", "PPBP", "CD79B", "LYZ", "IFI…</span>
<span class="co">#&gt; $ Top           &lt;int&gt; 1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 8, 9, 9, 10, 11…</span>
<span class="co">#&gt; $ p.value       &lt;dbl&gt; 7.673681e-23, 3.683285e-30, 2.667130e-17, 1.174240e-17, 2.632735e-11, 1.904…</span>
<span class="co">#&gt; $ FDR           &lt;dbl&gt; 8.402681e-21, 8.066393e-28, 1.168203e-15, 7.557534e-16, 7.207111e-10, 5.957…</span>
<span class="co">#&gt; $ summary.logFC &lt;dbl&gt; -4.7467317, -3.6811223, -3.5493442, -1.6773267, -3.6868802, -5.6944230, -2.…</span>
<span class="co">#&gt; $ logFC.2       &lt;dbl&gt; -2.60629181, -3.68112226, -1.05420348, -1.67732667, -1.96732725, -0.0458601…</span>
<span class="co">#&gt; $ logFC.3       &lt;dbl&gt; -4.74673175, -0.12080297, -0.05119315, 0.13734308, -3.68688025, -0.05364607…</span>
<span class="co">#&gt; $ logFC.4       &lt;dbl&gt; -0.09773581, -0.79739926, -3.54934421, 0.13734308, 0.28378634, -5.69442304,…</span>
<span class="co">#&gt; $ logFC.1       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …</span>

<span class="va">marker_genes_cluster</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">cluster</th>
<th align="left">gene</th>
<th align="right">Top</th>
<th align="right">p.value</th>
<th align="right">FDR</th>
<th align="right">summary.logFC</th>
<th align="right">logFC.2</th>
<th align="right">logFC.3</th>
<th align="right">logFC.4</th>
<th align="right">logFC.1</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">HLA-DRA</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">-4.746732</td>
<td align="right">-2.6062918</td>
<td align="right">-4.7467317</td>
<td align="right">-0.0977358</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">CST3</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">-3.681122</td>
<td align="right">-3.6811223</td>
<td align="right">-0.1208030</td>
<td align="right">-0.7973993</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">GPX1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">-3.549344</td>
<td align="right">-1.0542035</td>
<td align="right">-0.0511932</td>
<td align="right">-3.5493442</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">TYMP</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">-1.677327</td>
<td align="right">-1.6773267</td>
<td align="right">0.1373431</td>
<td align="right">0.1373431</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">HLA-DRB1</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">-3.686880</td>
<td align="right">-1.9673272</td>
<td align="right">-3.6868802</td>
<td align="right">0.2837863</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">PPBP</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">-5.694423</td>
<td align="right">-0.0458601</td>
<td align="right">-0.0536461</td>
<td align="right">-5.6944230</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="cell-types" class="section level2">
<h2 class="hasAnchor">
<a href="#cell-types" class="anchor"></a>Cell types</h2>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">marker_genes_cell_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scran/man/findMarkers.html">findMarkers</a></span><span class="op">(</span><span class="va">sce</span>, <span class="va">sce</span><span class="op">$</span><span class="va">cell_type_singler_blueprintencode_main</span><span class="op">)</span>
<span class="co">#&gt; Warning in FUN(...): no within-block comparison between Fibroblasts and B-cells</span>
<span class="co">#&gt; Warning in FUN(...): no within-block comparison between Fibroblasts and CD4+ T-cells</span>
<span class="co">#&gt; Warning in FUN(...): no within-block comparison between Fibroblasts and CD8+ T-cells</span>
<span class="co">#&gt; Warning in FUN(...): no within-block comparison between Fibroblasts and Endothelial cells</span>
<span class="co">#&gt; Warning in FUN(...): no within-block comparison between Fibroblasts and Erythrocytes</span>
<span class="co">#&gt; Warning in FUN(...): no within-block comparison between Monocytes and Fibroblasts</span>
<span class="co">#&gt; Warning in FUN(...): no within-block comparison between NK cells and Fibroblasts</span>

<span class="kw">for</span> <span class="op">(</span> <span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">marker_genes_cell_type</span><span class="op">)</span> <span class="op">)</span> <span class="op">{</span>
  <span class="va">marker_genes_cell_type</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">marker_genes_cell_type</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
      cell_type_singler_blueprintencode_main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">marker_genes_cell_type</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,
      gene <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="va">marker_genes_cell_type</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'logFC.'</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">marker_genes_cell_type</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, pattern <span class="op">=</span> <span class="st">' |\\-|\\+'</span>, replacement <span class="op">=</span> <span class="st">'.'</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>
<span class="op">}</span>

<span class="va">marker_genes_cell_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">bind_rows</span>, <span class="va">marker_genes_cell_type</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">cell_type_singler_blueprintencode_main</span>, <span class="va">gene</span>, <span class="va">Top</span>, <span class="va">p.value</span>, <span class="va">FDR</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>cell_type_singler_blueprintencode_main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span>
      <span class="va">cell_type_singler_blueprintencode_main</span>,
      levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">cell_type_singler_blueprintencode_main</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>

<span class="va">sce</span><span class="op">@</span><span class="va">metadata</span><span class="op">$</span><span class="va">marker_genes</span><span class="op">$</span><span class="va">scran</span><span class="op">$</span><span class="va">cell_type_singler_blueprintencode_main</span> <span class="op">&lt;-</span> <span class="va">marker_genes_cell_type</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Top</span><span class="op">)</span>, <span class="va">FDR</span> <span class="op">&lt;=</span> <span class="fl">0.1</span><span class="op">)</span>

<span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">marker_genes_cell_type</span><span class="op">)</span>
<span class="co">#&gt; Rows: 1,752</span>
<span class="co">#&gt; Columns: 14</span>
<span class="co">#&gt; $ cell_type_singler_blueprintencode_main &lt;fct&gt; B-cells, B-cells, B-cells, B-cells, B-cells, B-cel…</span>
<span class="co">#&gt; $ gene                                   &lt;chr&gt; "HLA-DRA", "HLA-DQB1", "TYROBP", "HLA-DRB1", "PPBP…</span>
<span class="co">#&gt; $ Top                                    &lt;int&gt; 1, 1, 1, 1, 1, 2, 2, 2, 3, 4, 4, 4, 5, 5, 5, 5, 6,…</span>
<span class="co">#&gt; $ p.value                                &lt;dbl&gt; 3.945181e-12, 4.288910e-08, 7.668231e-19, 2.381471…</span>
<span class="co">#&gt; $ FDR                                    &lt;dbl&gt; 1.439991e-10, 6.709081e-07, 1.679343e-16, 6.519278…</span>
<span class="co">#&gt; $ summary.logFC                          &lt;dbl&gt; 4.786161, 1.870992, -2.981126, 3.538704, -5.670599…</span>
<span class="co">#&gt; $ logFC.CD4..T.cells                     &lt;dbl&gt; 4.53437330, 2.57924662, -0.53466751, 3.97066659, -…</span>
<span class="co">#&gt; $ logFC.CD8..T.cells                     &lt;dbl&gt; 4.9264915, 2.8249252, -0.5007120, 3.5898855, 0.120…</span>
<span class="co">#&gt; $ logFC.Endothelial.cells                &lt;dbl&gt; 4.8046017, 2.8249252, 0.0000000, 3.9706666, -6.073…</span>
<span class="co">#&gt; $ logFC.Erythrocytes                     &lt;dbl&gt; 4.56757886, 2.82492521, 0.00000000, 3.97066659, -5…</span>
<span class="co">#&gt; $ logFC.Fibroblasts                      &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">#&gt; $ logFC.Monocytes                        &lt;dbl&gt; 2.140439941, 1.870991975, -2.981126027, 1.71955299…</span>
<span class="co">#&gt; $ logFC.NK.cells                         &lt;dbl&gt; 4.78616075, 2.82492521, -2.34779876, 3.53870363, 0…</span>
<span class="co">#&gt; $ logFC.B.cells                          &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span>

<span class="va">marker_genes_cell_type</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>booktabs <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">cell_type_singler_blueprintencode_main</th>
<th align="left">gene</th>
<th align="right">Top</th>
<th align="right">p.value</th>
<th align="right">FDR</th>
<th align="right">summary.logFC</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">B-cells</td>
<td align="left">HLA-DRA</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0e+00</td>
<td align="right">4.786161</td>
</tr>
<tr class="even">
<td align="left">B-cells</td>
<td align="left">HLA-DQB1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">7e-07</td>
<td align="right">1.870992</td>
</tr>
<tr class="odd">
<td align="left">B-cells</td>
<td align="left">TYROBP</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0e+00</td>
<td align="right">-2.981126</td>
</tr>
<tr class="even">
<td align="left">B-cells</td>
<td align="left">HLA-DRB1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1e-07</td>
<td align="right">3.538704</td>
</tr>
<tr class="odd">
<td align="left">B-cells</td>
<td align="left">PPBP</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0e+00</td>
<td align="right">-5.670599</td>
</tr>
<tr class="even">
<td align="left">B-cells</td>
<td align="left">CD79B</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">1e-07</td>
<td align="right">2.716659</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="export-to-cerebro-format" class="section level1">
<h1 class="hasAnchor">
<a href="#export-to-cerebro-format" class="anchor"></a>Export to Cerebro format</h1>
<p>Finally, we use the <code><a href="../reference/exportFromSeurat.html">exportFromSeurat()</a></code> function of cerebroApp to export our Seurat object to a <code>.crb</code> file which can be loaded into Cerebro.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/exportFromSCE.html">exportFromSCE</a></span><span class="op">(</span>
  <span class="va">sce</span>,
  assay <span class="op">=</span> <span class="st">'logcounts'</span>,
  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'cerebro_pbmc_SCE_'</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'.crb'</span><span class="op">)</span>,
  experiment_name <span class="op">=</span> <span class="st">'pbmc'</span>,
  organism <span class="op">=</span> <span class="st">'hg'</span>,
  groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'sample'</span>,<span class="st">'cluster'</span>,<span class="st">'cell_type_singler_blueprintencode_main'</span><span class="op">)</span>,
  nUMI <span class="op">=</span> <span class="st">'sum'</span>,
  nGene <span class="op">=</span> <span class="st">'detected'</span>,
  add_all_meta_data <span class="op">=</span> <span class="cn">TRUE</span>,
  verbose <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span>
<span class="co">#&gt; [17:58:05] Start collecting data...</span>
<span class="co">#&gt; Warning in if (class(expression_data) == "try-error") {: the condition has length &gt; 1 and only the</span>
<span class="co">#&gt; first element will be used</span>
<span class="co">#&gt; [17:58:05] Overview of Cerebro object:</span>
<span class="co">#&gt; class: Cerebro_v1.3</span>
<span class="co">#&gt; cerebroApp version: 1.3.1</span>
<span class="co">#&gt; experiment name: pbmc</span>
<span class="co">#&gt; organism: hg</span>
<span class="co">#&gt; date of analysis: 2021-03-12</span>
<span class="co">#&gt; date of export: 2021-03-12</span>
<span class="co">#&gt; number of cells: 79</span>
<span class="co">#&gt; number of genes: 219</span>
<span class="co">#&gt; grouping variables (3): sample, cluster, cell_type_singler_blueprintencode_main</span>
<span class="co">#&gt; cell cycle variables (0): </span>
<span class="co">#&gt; projections (2): UMAP, UMAP_3D</span>
<span class="co">#&gt; trees (0): </span>
<span class="co">#&gt; most expressed genes: </span>
<span class="co">#&gt; marker genes:</span>
<span class="co">#&gt;   - scran (2): cluster, cell_type_singler_blueprintencode_main</span>
<span class="co">#&gt; enriched pathways:</span>
<span class="co">#&gt; trajectories:</span>
<span class="co">#&gt; extra material:</span>
<span class="co">#&gt; [17:58:05] Saving Cerebro object to: cerebro_pbmc_SCE_2021-03-12.crb</span>
<span class="co">#&gt; [17:58:05] Done!</span></code></pre></div>
<p>The Cerebro use interface can be launched using the <code><a href="../reference/launchCerebro.html">launchCerebro()</a></code> function.</p>
</div>
<div id="session-info" class="section level1">
<h1 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session info</h1>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; R version 4.0.3 (2020-10-10)</span>
<span class="co">#&gt; Platform: x86_64-apple-darwin17.0 (64-bit)</span>
<span class="co">#&gt; Running under: macOS Big Sur 10.16</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Matrix products: default</span>
<span class="co">#&gt; BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib</span>
<span class="co">#&gt; LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt; [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt; [1] parallel  stats4    stats     graphics  grDevices utils     datasets  methods   base     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; other attached packages:</span>
<span class="co">#&gt;  [1] celldex_1.0.0               cerebroApp_1.3.1            SingleR_1.4.1              </span>
<span class="co">#&gt;  [4] scater_1.18.6               ggplot2_3.3.2               scran_1.18.5               </span>
<span class="co">#&gt;  [7] SingleCellExperiment_1.12.0 SummarizedExperiment_1.20.0 Biobase_2.50.0             </span>
<span class="co">#&gt; [10] GenomicRanges_1.42.0        GenomeInfoDb_1.26.2         IRanges_2.24.1             </span>
<span class="co">#&gt; [13] S4Vectors_0.28.1            BiocGenerics_0.36.0         MatrixGenerics_1.2.0       </span>
<span class="co">#&gt; [16] matrixStats_0.57.0          dplyr_1.0.2                 BiocManager_1.30.10        </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;   [1] AnnotationHub_2.22.0          BiocFileCache_1.14.0          systemfonts_1.0.1            </span>
<span class="co">#&gt;   [4] plyr_1.8.6                    igraph_1.2.6                  lazyeval_0.2.2               </span>
<span class="co">#&gt;   [7] splines_4.0.3                 GSEABase_1.52.1               shinydashboard_0.7.1         </span>
<span class="co">#&gt;  [10] BiocParallel_1.24.1           listenv_0.8.0                 usethis_2.0.0                </span>
<span class="co">#&gt;  [13] digest_0.6.27                 htmltools_0.5.1.1             viridis_0.5.1                </span>
<span class="co">#&gt;  [16] fansi_0.4.1                   magrittr_2.0.1                memoise_1.1.0                </span>
<span class="co">#&gt;  [19] remotes_2.2.0                 limma_3.46.0                  shinyFiles_0.9.0             </span>
<span class="co">#&gt;  [22] readr_1.4.0                   globals_0.14.0                annotate_1.68.0              </span>
<span class="co">#&gt;  [25] askpass_1.1                   pkgdown_1.6.1                 prettyunits_1.1.1            </span>
<span class="co">#&gt;  [28] colorspace_2.0-0              blob_1.2.1                    rappdirs_0.3.1               </span>
<span class="co">#&gt;  [31] textshaping_0.3.0             xfun_0.19                     callr_3.5.1                  </span>
<span class="co">#&gt;  [34] crayon_1.3.4                  RCurl_1.98-1.2                jsonlite_1.7.2               </span>
<span class="co">#&gt;  [37] graph_1.68.0                  ape_5.4-1                     glue_1.4.2                   </span>
<span class="co">#&gt;  [40] gtable_0.3.0                  zlibbioc_1.36.0               XVector_0.30.0               </span>
<span class="co">#&gt;  [43] DelayedArray_0.16.1           pkgbuild_1.2.0                BiocSingular_1.6.0           </span>
<span class="co">#&gt;  [46] future.apply_1.6.0            scales_1.1.1                  msigdbr_7.2.1                </span>
<span class="co">#&gt;  [49] DBI_1.1.0                     edgeR_3.32.1                  miniUI_0.1.1.1               </span>
<span class="co">#&gt;  [52] Rcpp_1.0.5                    viridisLite_0.3.0             xtable_1.8-4                 </span>
<span class="co">#&gt;  [55] progress_1.2.2                dqrng_0.2.1                   bit_4.0.4                    </span>
<span class="co">#&gt;  [58] rsvd_1.0.3                    GSVA_1.38.0                   DT_0.16                      </span>
<span class="co">#&gt;  [61] htmlwidgets_1.5.3             httr_1.4.2                    FNN_1.1.3                    </span>
<span class="co">#&gt;  [64] ellipsis_0.3.1                pkgconfig_2.0.3               XML_3.99-0.5                 </span>
<span class="co">#&gt;  [67] scuttle_1.0.4                 uwot_0.1.10                   dbplyr_2.0.0                 </span>
<span class="co">#&gt;  [70] utf8_1.1.4                    locfit_1.5-9.4                reshape2_1.4.4               </span>
<span class="co">#&gt;  [73] tidyselect_1.1.0              rlang_0.4.9                   later_1.1.0.1                </span>
<span class="co">#&gt;  [76] AnnotationDbi_1.52.0          BiocVersion_3.12.0            munsell_0.5.0                </span>
<span class="co">#&gt;  [79] tools_4.0.3                   cli_2.2.0                     ExperimentHub_1.16.0         </span>
<span class="co">#&gt;  [82] generics_0.1.0                RSQLite_2.2.1                 devtools_2.3.2               </span>
<span class="co">#&gt;  [85] evaluate_0.14                 stringr_1.4.0                 fastmap_1.0.1                </span>
<span class="co">#&gt;  [88] yaml_2.2.1                    ragg_1.1.0                    processx_3.4.5               </span>
<span class="co">#&gt;  [91] knitr_1.30                    bit64_4.0.5                   fs_1.5.0                     </span>
<span class="co">#&gt;  [94] shinycssloaders_1.0.0         purrr_0.3.4                   pbapply_1.4-3                </span>
<span class="co">#&gt;  [97] future_1.21.0                 nlme_3.1-151                  sparseMatrixStats_1.2.1      </span>
<span class="co">#&gt; [100] mime_0.9                      xml2_1.3.2                    biomaRt_2.46.0               </span>
<span class="co">#&gt; [103] compiler_4.0.3                interactiveDisplayBase_1.28.0 beeswarm_0.3.1               </span>
<span class="co">#&gt; [106] plotly_4.9.2.2                curl_4.3                      testthat_3.0.1               </span>
<span class="co">#&gt; [109] tibble_3.0.4                  statmod_1.4.35                stringi_1.5.3                </span>
<span class="co">#&gt; [112] highr_0.8                     ps_1.5.0                      RSpectra_0.16-0              </span>
<span class="co">#&gt; [115] desc_1.2.0                    lattice_0.20-41               bluster_1.0.0                </span>
<span class="co">#&gt; [118] Matrix_1.3-0                  shinyjs_2.0.0                 vctrs_0.3.6                  </span>
<span class="co">#&gt; [121] pillar_1.4.7                  lifecycle_0.2.0               BiocNeighbors_1.8.2          </span>
<span class="co">#&gt; [124] data.table_1.13.4             bitops_1.0-6                  irlba_2.3.3                  </span>
<span class="co">#&gt; [127] qvalue_2.22.0                 httpuv_1.5.4                  R6_2.5.0                     </span>
<span class="co">#&gt; [130] promises_1.1.1                gridExtra_2.3                 vipor_0.4.5                  </span>
<span class="co">#&gt; [133] parallelly_1.22.0             sessioninfo_1.1.1             codetools_0.2-18             </span>
<span class="co">#&gt; [136] pkgload_1.1.0                 colourpicker_1.1.0            assertthat_0.2.1             </span>
<span class="co">#&gt; [139] openssl_1.4.3                 rprojroot_2.0.2               shinyWidgets_0.5.4           </span>
<span class="co">#&gt; [142] withr_2.3.0                   GenomeInfoDbData_1.2.4        hms_0.5.3                    </span>
<span class="co">#&gt; [145] grid_4.0.3                    beachmat_2.6.4                tidyr_1.1.2                  </span>
<span class="co">#&gt; [148] rmarkdown_2.6                 DelayedMatrixStats_1.12.3     shiny_1.5.0                  </span>
<span class="co">#&gt; [151] ggbeeswarm_0.6.0</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Roman Hillje.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
